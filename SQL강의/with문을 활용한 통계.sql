-- 통계 DB
CREATE DATABASE StatisticsDB;
USE StatisticsDB;

-- 설명: 각 부서에서 발생한 수익 또는 지출 내역을 기록하는 테이블입니다. 
-- 부서, 항목, 금액, 거래 날짜 및 거래 유형 정보가 포함됩니다.
CREATE TABLE transactions (
   transaction_id INT AUTO_INCREMENT PRIMARY KEY,      -- 각 거래의 고유 식별자 
   transaction_date DATE,                              -- 거래가 발생한 날짜.
   department VARCHAR(50),                             -- 거래가 발생한 부서 (예: 영업, 마케팅, IT 등).
   item VARCHAR(50),                                   -- 거래 항목 (예: 상품 A, 광고비 등).
   amount DECIMAL(15, 2),                              -- 거래 금액
   transaction_type ENUM('Revenue', 'Expense')         -- 거래 유형 (수익 또는 지출).
);


-- budget 테이블 생성
CREATE TABLE budget (
   department VARCHAR(50) PRIMARY KEY,
   budget DECIMAL(15, 2)
);

-- 각 부서별 예산 데이터를 삽입
INSERT INTO budget (department, budget) VALUES
('영업', 5000000.00),
('마케팅', 2000000.00),
('IT', 1500000.00),
('재무', 2500000.00),
('인사', 1200000.00);

-- 100개의 거래 데이터 추가
INSERT INTO transactions (transaction_date, department, item, amount, transaction_type) VALUES
('2024-01-05', '영업', '상품 A', 200000.00, 'Revenue'),
('2024-01-10', '영업', '상품 B', 150000.00, 'Revenue'),
('2024-01-20', '마케팅', '광고비', 50000.00, 'Expense'),
('2024-01-25', '영업', '상품 A', 180000.00, 'Revenue'),
('2024-02-01', 'IT', '소프트웨어 구입', 30000.00, 'Expense'),
('2024-02-05', '영업', '상품 C', 220000.00, 'Revenue'),
('2024-02-10', '재무', '컨설팅 비용', 80000.00, 'Expense'),
('2024-02-15', '영업', '상품 B', 190000.00, 'Revenue'),
('2024-02-20', '인사', '채용 비용', 120000.00, 'Expense'),
('2024-02-25', '영업', '상품 D', 210000.00, 'Revenue'),
('2024-03-01', '마케팅', '프로모션', 60000.00, 'Expense'),
('2024-03-05', '영업', '상품 E', 230000.00, 'Revenue'),
('2024-03-10', 'IT', '장비 구입', 50000.00, 'Expense'),
('2024-03-15', '영업', '상품 F', 210000.00, 'Revenue'),
('2024-03-20', '마케팅', '광고비', 70000.00, 'Expense'),
('2024-03-25', '재무', '회계 컨설팅', 90000.00, 'Expense'),
('2024-04-01', '영업', '상품 A', 240000.00, 'Revenue'),
('2024-04-05', '인사', '교육 비용', 45000.00, 'Expense'),
('2024-04-10', '마케팅', '브랜딩 비용', 85000.00, 'Expense'),
('2024-04-15', 'IT', '네트워크 비용', 60000.00, 'Expense'),
('2024-04-20', '영업', '상품 G', 250000.00, 'Revenue'),
('2024-04-25', '재무', '보험료', 100000.00, 'Expense'),
('2024-05-01', '인사', '직원 복지', 70000.00, 'Expense'),
('2024-05-05', '영업', '상품 H', 260000.00, 'Revenue'),
('2024-05-10', '마케팅', '프로모션', 75000.00, 'Expense'),
('2024-05-15', 'IT', '클라우드 비용', 45000.00, 'Expense'),
('2024-05-20', '재무', '재무 컨설팅', 90000.00, 'Expense'),
('2024-05-25', '영업', '상품 I', 275000.00, 'Revenue'),
('2024-06-01', '마케팅', '광고비', 80000.00, 'Expense'),
('2024-06-05', '영업', '상품 J', 285000.00, 'Revenue'),
('2024-06-10', 'IT', '서버 비용', 120000.00, 'Expense'),
('2024-06-15', '재무', '법률 자문', 110000.00, 'Expense'),
('2024-06-20', '인사', '복지 혜택', 65000.00, 'Expense'),
('2024-06-25', '영업', '상품 K', 290000.00, 'Revenue'),
('2024-07-01', '마케팅', '마케팅 리서치', 95000.00, 'Expense'),
('2024-07-05', '영업', '상품 L', 300000.00, 'Revenue'),
('2024-07-10', 'IT', '보안 솔루션', 125000.00, 'Expense'),
('2024-07-15', '재무', '자산 평가', 115000.00, 'Expense'),
('2024-07-20', '영업', '상품 M', 310000.00, 'Revenue'),
('2024-07-25', '인사', '직원 연수', 75000.00, 'Expense'),
('2024-08-01', '마케팅', '디지털 마케팅', 105000.00, 'Expense'),
('2024-08-05', '영업', '상품 N', 320000.00, 'Revenue'),
('2024-08-10', 'IT', '데이터베이스 유지보수', 95000.00, 'Expense'),
('2024-08-15', '재무', '회계 비용', 120000.00, 'Expense'),
('2024-08-20', '인사', '사내 교육', 80000.00, 'Expense'),
('2024-08-25', '영업', '상품 O', 330000.00, 'Revenue'),
('2024-09-01', '마케팅', '컨텐츠 제작', 115000.00, 'Expense'),
('2024-09-05', '영업', '상품 P', 340000.00, 'Revenue'),
('2024-09-10', 'IT', 'IT 지원 서비스', 100000.00, 'Expense'),
('2024-09-15', '재무', '자문 비용', 125000.00, 'Expense'),
('2024-09-20', '인사', '직원 채용', 130000.00, 'Expense'),
('2024-09-25', '영업', '상품 Q', 350000.00, 'Revenue'),
('2024-10-01', '마케팅', '소셜 미디어 광고', 110000.00, 'Expense'),
('2024-10-05', '영업', '상품 R', 360000.00, 'Revenue'),
('2024-10-10', 'IT', '보안 감사', 135000.00, 'Expense'),
('2024-10-15', '재무', '부채 관리', 140000.00, 'Expense'),
('2024-10-20', '인사', '사내 복지', 90000.00, 'Expense'),
('2024-10-25', '영업', '상품 S', 370000.00, 'Revenue'),
('2024-11-01', '마케팅', '이벤트 기획', 130000.00, 'Expense'),
('2024-11-05', '영업', '상품 T', 380000.00, 'Revenue'),
('2024-11-10', 'IT', '백업 솔루션', 105000.00, 'Expense'),
('2024-11-15', '재무', '비용 분석', 145000.00, 'Expense'),
('2024-11-20', '인사', '채용 비용', 95000.00, 'Expense'),
('2024-11-25', '영업', '상품 U', 390000.00, 'Revenue'),
('2024-12-01', '마케팅', '프로모션 비용', 125000.00, 'Expense'),
('2024-12-05', '영업', '상품 V', 400000.00, 'Revenue'),
('2024-12-10', 'IT', '네트워크 관리', 115000.00, 'Expense'),
('2024-12-15', '재무', '법률 자문', 160000.00, 'Expense'),
('2024-12-20', '인사', '직원 복지', 110000.00, 'Expense'),
('2024-12-25', '영업', '상품 W', 410000.00, 'Revenue');

SELECT 
   department, 
   transaction_type, 
   SUM(amount) AS total_amount
FROM 
   transactions
GROUP BY 
   department, transaction_type WITH ROLLUP;
 

-- 설명

-- department, transaction_type: 집계를 수행할 컬럼입니다.
-- SUM(amount): amount 컬럼의 합계를 계산합니다.
-- WITH ROLLUP: department와 transaction_type을 기준으로 집계한 후, 상위 집계 수준을 추가합니다.
-- 결과에서는 각 부서별, 거래 유형별 합계와 함께, 부서별 총합, 거래 유형별 총합, 전체 합계도 출력됩니다.